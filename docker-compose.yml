version: '3.6'
services:
    tests:
        container_name: test
        build:
            context: .
            dockerfile: Dockerfile
            target: test
            args:
                BUILD_NUMBER: 0.0.0.1
                PAT: your-pat
        volumes:
            - ./local/tests:/artifacts/tests
    migration:
        container_name: migration
        build:
            context: .
            dockerfile: Dockerfile
            target: migration
            args:
                BUILD_NUMBER: 0.0.0.1
                PAT: your-pat
        depends_on:
            -   tests
    api:
        container_name: api
        build:
            context: .
            dockerfile: Dockerfile
            target: api
            args:
                BUILD_NUMBER: 0.0.0.1
                PAT: your-pat
        depends_on:
            - migrations
            -   tests
        ports:
            -   8081:80
        environment:
            DOTNET_ENVIRONMENT: Development